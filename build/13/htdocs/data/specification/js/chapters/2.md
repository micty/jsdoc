

##2.JavaScript代码格式
关于JavaScript，你必须知道，你不是一个人在战斗，所有的代码都要变成可供他人容易阅读的。 在一个软件的整个生命周期里，一个程序可能会被许多人阅读或修改。如果一个程序可以清晰的展现出它的结构和特征，那就能减少在以后对其进行修改时出错的可能性。JavaScript 的代码格式是给代码阅读者最直观的感受，直接影响到阅读心情和效率。良好的代码格式不仅体现代码编写者的清晰的逻辑思维，更体现了一个人的外在美与爱美之心。

JavaScript 的代码格式化工具有很多，包括各种 IDE 开发工具自身都内置了一套默认的格式。 为了协同团队一致性，特拟定以下代码格式，请自行设置好自己的 IDE 开发工具。

###2.1 缩进
关于缩进的问题，不只是 JavaScript，几乎所有的语言编写的时候，都会提及缩进的问题。缩进几乎是代码编写规范的第一课，是代码可阅读性判断的直接因素。代码缩进的好处是不言而喻的，但是对于如何缩进，则没有标准而言。最受欢迎的是方便使用 `Tab` 键缩进，也有些喜欢用 2 个、4 个、8 个空格进行缩进。这样缩进风格不一，也同样给代码的阅读带来障碍。

本规范提倡用 `4` 个空格来进行缩进，并在同一产品中采用同一种缩进标准。不支持用 `Tab` 键进行缩进，这是因为直到现在还没有统一的标准来定义 `Tab` 所代替的空白大小，有些编辑器解析为 `4` 个空格大小，有些则解析为 `8` 个。因而用不同的编辑器查看代码，可能造成格式混乱。当然 `Tab `简单易用，为解决这个问题，**建议在设置开发环境时，将编辑器里的 `Tab` 快捷键重新设置为 `4` 个空格**。

###2.2 行长度
每行代码应尽量不超过 `80` 个字符。如果代码较长，应尽量选择换行，下一行代码应缩进 `8` 个空格。这样可以使代码排版整齐，减轻阅读代码的疲劳感。换行缩进 `8` 个空格可以和代码段的缩进 `4` 个空格区分开，以增强代码的可阅读性。

如果代码行较长需要换行的时候，换行应选择在操作符和标点符号之后，最好是在逗号之后，而不要在变量名、字符串、数字、或 `)`、`]`、`++` 、`--` 等符号之后换行。这样可以有效的防止拷贝、粘贴而引起的错误，并可有效地增强代码的可阅读性。

###2.3多个变量的声明格式
多个变量的声明格式主要分 单 `var` 模式 和 多 `var` 模式，两种方式各有其优缺点。不管何种方式，为避免意外引入或修改了全局变量，**所有的变量在使用前必须通过 `var` 关键字进行声明**。

####2.3.1单 var 模式（`不推荐`）
单 `var` 模式逗号风格的兴起，是 NCZ 在2009 年介绍 YUI Compressor 压缩原理时提到的。NCZ 倡导：为了帮助压缩工具实现更好的压缩，倡导一个函数内，尽量只保持一个 `var` 和 `return`。然而，目前高级压缩器，Closure Compiler 和 UglifyJS 等，都能自动处理 `var` 了，在压缩函数时，会自动做变量提升和 `var` 单一化。因此尽量保持一个 `var` 的最佳实践，目前已不是最佳实践，大方向肯定是更人性化、更自然化的写法，优化交给工具就好。

单 `var` 模式的推荐在函数开始处把函数内要用到的所有变量一次性声明出来，并且通过逗号进行分隔。如：

``` javascript

//不推荐
var cache, len, all, list, args = [], event, i;

```

如果赋值语句较长或变量比较多，目前有一种写法是用逗号换行：

``` javascript

//不推荐
function fn() {
        
    var count = 10,
        name = "Nicholas",
        found = false,
        map = {},
        list = [],
        get = function () {
            //...
            //这个函数可能很长很长
        },
        //...
        //这里可能还会有很多个变量，占据很多行
        empty;
        
    //do something...

}

```

单 `var` 模式的最大优点是可以比较集中的清晰看到一个函数内要用到的所有变量，并且可以避免意外引入或修改了全局变量。但这种方式本规范不推荐使用，原因有：
- 1.当变量过多时，占据的篇幅行数就会过多，代码阅读者看到最后，容易忘记这是一个局部变量还是一个全局变量，甚至误当成写错了格式的 `key: value` 形式的 `Object` 对象的成员；
- 2.不容易在后期进行修改，比如要把某个变量迁移到其他位置时，因为其前面缺少 `var` 关键字，并且后面是个逗号，修改起来麻烦，容易变成全局变量；
- 3.人的记忆范围有限，一次性声明过多变量会加重代码阅读者（甚至代码编写者）的记忆压力，造成混淆，当在后面看到某个变量时，得向前翻查该变量定义的位置以及初始值，跳跃空间太大，容易打断阅读者的思维。

####2.3.2多 var 模式（`推荐`）
吐槽太多不利身心健康，为解决上述问题，本规范推荐使用多` var` 模式进行变量声明：
- 1.一个变量对应一个 `var` 关键字开始和一个分号结束；
- 2.按需声明，在第一次需要使用该变量时即声明；
- 3.变量声明的位置尽量靠近第一次使用时的位置；
- 4.变量尽量按类型给定初始值(看情况)。

``` javascript

//推荐。 按需声明变量，变量声明的位置与使用的位置尽量靠近
function fn() {

    //不推荐
    var cache, event, all, list, i, len, rest = [], args;

	//推荐
    var count = 10;
    var name = 'Nicholas';
    console.log(name + '=' + count);

    var map = {};
    var list = [];
    var found = name in map;
    if (found) {
        list.push(name);
    }

    var get = function () {
        //...
        //这个函数可能很长很长
    };

    var empty;

    //do something...

}

```

**多 `var` 模式更符合人类思维的局部记忆原理，把最相关的代码组织在位置最近的地方，代码逻辑更不容易出错，以后要移除某段逻辑时，只需要关注某一段代码即可，做代码重构（比如提取函数）时，也更方便。**

###2.4 花括号

关于花括号的格式一直比较受争议，习惯写后台程序的同学可能比较喜欢首花括号换行，这样显示得比较有对称美。为了适应前端业界大多数的习惯，本规范里的首花括号不换行，这也在某些方面可以避免解析错误。

``` javascript

//推荐
if (foo) {
        
}

//不推荐，首花括号不需要换行
if (foo)
{

}

//不推荐，首花括号不需要换行
var obj =
{

};
    
```

为方便阅读和以后增加代码，凡是有代码块的地方，如条件判断、循环等，不管语句的多少，都要用花括号括起来。如：

``` javascript

//推荐
if (foo) {
    return;
}

//不推荐，没有换行缩进，结构不明朗
if (foo) return;

//不推荐，有换行与缩进，但没有块效果，不方便以后增加语句并且容易出错
if (foo)
    return;
        
```

###2.5 空白符
适当的空白行可以大大提高代码的可阅读性，可以使代码逻辑更清晰易懂。同时，在表达式中适当的留空白，也会给代码的阅读带来方便。

操作符之间前后各需要一个空格。如

``` javascript

//推荐
var x = y + z;

//不推荐，太密集
var x=y+z;
        
```

对象立即量 `{ }` 中的成员里，冒号前无空格，冒号后只空一格。如：

``` javascript

//推荐
var obj = {
    a: 1,
    longname: 2
};

//不推荐
var obj = {
    a:1,            //太密集，冒号后需要一个空格
    b : 2,          //太松散，冒号前不需要空格
    c       : 3,    //不需要刻意去对齐，因为在未来不可控
    longname: 4 
};
        
```

逗号的后面需要留空白，以显示明确的参数间隔，变量间隔等。函数定义分匿名函数与具名函数，匿名函数的圆括号前后都需要一个空格；而具名函数的前圆括号不需要。并且函数中的多个参数都要用带空格的逗号分隔。如：

``` javascript

//推荐
var fn = function (a, b, c) {

};

//推荐
function fn(a, b, c) {

}

//不推荐，原因：
//1.左圆括号不能紧跟 function 关键字；
//2.右圆括号跟函数体开始的花括号需空一格；
//3.参数间的逗号需要空一格，不然太密集
var fn = function(a,b,c){

};

//不推荐
//具名函数名后面的左圆括号不需要空一格，并且参数前后空格太多。
function fn ( a, b, c ) {

}
        
```

函数调用的，函数名称后面不需要空格。如：

``` javascript

//推荐
fn(0, 1, 2);

//不推荐，参数间太密集，需要空格
fn(0,1,2);

//不推荐，函数调用的函数名称后面不需要空格
fn (0, 1, 2);
      
```

###2.6 语句必须以分号结束
所有 JavaScript 语句必须以分号结束，以防止在压缩与精简代码时出错。同时，一行代码最多有一个语句。如果一个赋值语句是用函数、对象、数组来赋值，可能会跨多行，一定切记要在赋值语句末加上分号。

这是因为 JavaScript 中，所有表达式都可以当语句，遇换行符时会解析为表达式的结束，此时不规范的换行和分号的丢失，可能引入新的错误。

``` javascript

//推荐
var obj = {
        
};

//推荐
var array = [

];

//推荐
var fn = function () {

}; //通过这种方式定义函数，结束处的分号不能少


//不推荐
var fn = function () {

} // <--缺少分号

//不推荐
function fn() {

}; //不是通过 var 定义的函数结束处，不需要分号
    
```
###2.7 单引号与双引号
在 JavaScript 中，字符串可以用单引号括起来，也可以用双引号括起来。考虑到 HTML 中的属性值的引号使用情况，本规范推荐 JavaScript 中的字符串统一用单引号括起来；HTML 中的属性值用双引号括起来。这样可以最大程度减少转义符的使用，让代码更易读与美观。如：

``` javascript
    
var name = 'Nichlas says: "hi" ';

```


``` html

<a href="showDetail('test')">显示详情<a/>

```


-----------------------------------------------------------------------------------------------





